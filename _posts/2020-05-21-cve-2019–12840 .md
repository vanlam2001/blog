---
title: Exploiting Redis 4.0.9 for RCE & Webmin 1.910 for PrivEsc
date: 27/7/2021
layout: single
header:
   teaser: https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/intro.PNG
---


## Mô tả 
Tác giả  khai thác dịch vụ Redis để có được trình bao tương tác đầu tiên. Sau đó tác giả  sẽ sử dụng lỗ hổng CVE 2019–12840 được ghi lại trên trình bao gốc để khai thác máy chủ Webmin.
+ Tác giả: faisalfs10x


## HTB - Postman

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/intro.PNG)

Đó là một hộp dễ sử dụng. Tác giả  sẽ khai thác dịch vụ Redis để có được trình bao tương tác đầu tiên. Sau đó, sẽ chuyển đến người dùng tiếp theo bằng cách xem xét thêm. Sử dụng lỗ hổng CVE 2019–12840 được ghi lại trên trình bao gốc để khai thác máy chủ Webmin
## Scan
```powershell
nmap -Pn --open -sC -sV -p- -T4 10.10.10.160 
```
![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/1.png)

Từ quá trình quét nmap, tác giả  đã phát hiện ra các cổng không phổ biến là 6379 và 10000, Redis key-value store 4.0.9 và http MiniServ 1.910 (Webmin httpd) tương ứng.

## Khai Thác 
Sau đó, tác giả  tìm thấy Redis RCE khai thác từ Packet Storm Security, có thể khai thác máy chủ Redis chưa được xác thực bằng cách ghi nội dung vào bộ nhớ của máy chủ Redis. Tác giả phải tạo khóa SSH của riêng mình và chèn khóa công khai bên trong máy chủ Redis để có thể SSH vào hộp.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/2.png)

## Ghi Khóa Công khai vào Bộ nhớ bằng redis-CLI:

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/3.png)

## Redis user to Matt
Sau đó, chúng ta có thể SSH thành người dùng redis trên hộp. Tuy nhiên, chúng tôi chưa thể đọc `user.txt`. Trước tiên, chúng tôi cần báo cáo cho người dùng `Matt`.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/4.png)

```powershell
$: /home$ cd Matt/
$: /home/Matt$ ls
user.txt
$: /home/Matt$ cat user.txt
cat: user.txt: Permission denied
```
Trong khi thực hiện liệt kê, chúng tôi tìm thấy tệp `id_rsa.bak` trong `/opt` là bản sao lưu id_rsa cho người dùng Matt.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/6.png)

Sau đó, sao chép nội dung `id_rsa` vào máy cục bộ của mình để bẻ khóa.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/7.png)

## Cracking id_rsa key:

Tác giả  phải chuyển đổi định dạng bằng cách sử dụng tiện ích john có tên `ssh2john` trước khi bẻ khóa. ssh2john có thể chuyển đổi khóa cá nhân sang định dạng mà john có thể bẻ khóa nó

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/8.png)

Tác giả  có thể bẻ khóa key và lấy `computer2008` làm chìa khóa.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/9.png)

Sau đó, Tác giả  đã cố gắng SSH với tư cách người dùng Matt nhưng kết nối đã bị máy chủ đóng.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/10.png)

Tuy nhiên,  có thể chuyển thành Matt bởi người dùng thay thế và đọc `user.txt`

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/11.png)

## Leo thang đặc quyền

[![Language](https://img.shields.io/badge/Lang-msfconsole-blue.svg)](https://www.metasploit.com/)

Tác giả đã sử dụng metasploit để khai khác nó, dựa trên quét nmap, tác giả  thấy rằng dịch vụ `Webmin 1.910 trên cổng 10000` đã hoạt động. Bằng cách sử dụng searchsploit, chúng tôi đã tìm thấy khai thác RCE trong mô-đun Metasploit.

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/12.png)

Tác giả  đã điền tất cả các cài đặt bắt buộc cho mô-đun bằng cách sử dụng cùng một thông tin đăng nhập cho người dùng Matt và nhận root shell.

![show_options](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/13.png)

![alt text](https://raw.githubusercontent.com/faisalfs10x/faisalfs10x.github.io/master/asset/htbwriteup/linux/postman/14.png)

## Chúc May Mắn :D
